# Ambiente de Laborat√≥rio - GNS3 com RouterOS e Docker

## üéØ Vis√£o Geral do Laborat√≥rio

Este ambiente simula uma infraestrutura de rede empresarial usando **GNS3** como plataforma de virtualiza√ß√£o, **RouterOS (MikroTik)** para equipamentos de rede e **containers Docker** para simular computadores e servidores.

### **Objetivos do Laborat√≥rio**
- Validar automa√ß√£o de configura√ß√£o via Ansible
- Testar integra√ß√£o NetBox ‚Üí Zabbix
- Simular cen√°rios reais de troubleshooting
- Demonstrar pipelines CI/CD em ambiente controlado
- Treinar equipe em ferramentas de automa√ß√£o

---

## üèóÔ∏è Arquitetura do Laborat√≥rio

### **Topologia de Rede**
```
                    [Internet Cloud]
                           |
                    [RouterOS-GW]
                     (10.0.0.1/24)
                           |
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ                                 ‚îÇ
    [RouterOS-SW1]                  [RouterOS-SW2]
   (192.168.10.1/24)               (192.168.20.1/24)
           ‚îÇ                                 ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ             ‚îÇ                  ‚îÇ             ‚îÇ
[Docker-PC1] [Docker-PC2]      [Docker-SRV1] [Docker-SRV2]
.10.10/24    .10.20/24         .20.10/24     .20.20/24

                    [Management Network]
                        (172.16.0.0/24)
                             ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ           ‚îÇ           ‚îÇ
            [NetBox]    [Zabbix]   [GitLab-CI]
           .16.10/24   .16.20/24   .16.30/24
```

### **Componentes do Ambiente**
- **3x RouterOS**: Gateway + 2 Switches L3
- **4x Docker Containers**: Simular PCs e Servidores
- **3x Servi√ßos**: NetBox, Zabbix, GitLab-CI
- **1x Cloud**: Acesso √† internet (NAT)

---

## üñ•Ô∏è Configura√ß√£o do GNS3

### **Requisitos do Sistema Host**
- **CPU**: 8+ cores (Intel VT-x/AMD-V habilitado)
- **RAM**: 16GB+ (32GB recomendado)
- **Storage**: 50GB+ SSD dispon√≠vel
- **OS**: Ubuntu 20.04+ ou Windows 10/11
- **Virtualiza√ß√£o**: KVM (Linux) ou VMware/VirtualBox (Windows)

### **Instala√ß√£o GNS3**

#### **Ubuntu/Linux**
```bash
# Adicionar reposit√≥rio GNS3
sudo add-apt-repository ppa:gns3/ppa
sudo apt update

# Instalar GNS3 GUI e Server
sudo apt install gns3-gui gns3-server

# Configurar usu√°rio para usar GNS3
sudo usermod -aG gns3 $USER
sudo usermod -aG docker $USER
sudo usermod -aG libvirt $USER

# Instalar depend√™ncias adicionais
sudo apt install qemu-kvm qemu-utils libvirt-daemon-system libvirt-clients bridge-utils virt-manager
```

#### **Configura√ß√£o Inicial**
```bash
# Iniciar servi√ßos
sudo systemctl enable libvirtd
sudo systemctl start libvirtd

# Configurar bridge para networking
sudo virsh net-start default
sudo virsh net-autostart default
```

### **Configura√ß√£o do GNS3 Server**
```json
{
    "version": "2.2.0",
    "type": "topology",
    "revision": 1,
    "auto_close": true,
    "auto_open": false,
    "auto_start": false,
    "drawing_grid_size": 25,
    "grid_size": 75,
    "show_grid": false,
    "show_interface_labels": true,
    "show_layers": false,
    "snap_to_grid": false,
    "supplier": null,
    "variables": null
}
```

---

## üîß RouterOS (MikroTik) no GNS3

### **Download e Prepara√ß√£o**
- **Imagem**: RouterOS CHR (Cloud Hosted Router)
- **Vers√£o**: 7.x Long-term (stable)
- **Formato**: VMDK ou QCOW2
- **Tamanho**: ~50MB compactado

### **Configura√ß√£o no GNS3**

#### **Template RouterOS**
```
Nome: MikroTik RouterOS 7.x
Tipo: QEMU VM
Categoria: Router
Symbol: :/symbols/router.svg

Configura√ß√µes de VM:
- RAM: 512MB (m√≠nimo), 1GB (recomendado)
- Disk: 1GB (suficiente para configura√ß√µes)
- Network adapters: 4x Intel e1000
- Console: telnet (porta autom√°tica)
- Boot priority: HDD
```

#### **Configura√ß√£o Base RouterOS**
```bash
# Configura√ß√£o inicial via console
/user set 0 password=admin123
/ip service set telnet disabled=no
/ip service set ssh disabled=no

# Configurar interface de management
/ip address add address=172.16.0.1/24 interface=ether1
/ip route add gateway=172.16.0.254

# Habilitar SNMP para Zabbix
/snmp set enabled=yes
/snmp community set 0 name=public

# Configurar NTP
/system ntp client set enabled=yes servers=pool.ntp.org
```

### **Templates por Fun√ß√£o**

#### **RouterOS-Gateway**
```bash
# Configura√ß√£o WAN/LAN
/ip address add address=10.0.0.1/24 interface=ether1 comment="WAN"
/ip address add address=192.168.1.1/24 interface=ether2 comment="LAN"

# NAT para internet
/ip firewall nat add chain=srcnat action=masquerade out-interface=ether1

# DHCP Server
/ip pool add name=dhcp-pool ranges=192.168.1.100-192.168.1.200
/ip dhcp-server add name=dhcp1 interface=ether2 address-pool=dhcp-pool
/ip dhcp-server network add address=192.168.1.0/24 gateway=192.168.1.1 dns-server=8.8.8.8

# Firewall b√°sico
/ip firewall filter add chain=input action=accept connection-state=established,related
/ip firewall filter add chain=input action=accept protocol=icmp
/ip firewall filter add chain=input action=drop in-interface=ether1
```

#### **RouterOS-Switch**
```bash
# Configura√ß√£o L3 Switch
/interface bridge add name=bridge1
/interface bridge port add bridge=bridge1 interface=ether2
/interface bridge port add bridge=bridge1 interface=ether3
/interface bridge port add bridge=bridge1 interface=ether4

# VLANs
/interface vlan add name=vlan10 vlan-id=10 interface=bridge1
/interface vlan add name=vlan20 vlan-id=20 interface=bridge1

# Endere√ßamento por VLAN
/ip address add address=192.168.10.1/24 interface=vlan10
/ip address add address=192.168.20.1/24 interface=vlan20

# Inter-VLAN routing habilitado por padr√£o
```

---

## üê≥ Docker Containers como Computadores

### **Imagens Docker Personalizadas**

#### **Dockerfile - Ubuntu Desktop Simulado**
```dockerfile
FROM ubuntu:22.04

# Instalar ferramentas de rede e utilit√°rios
RUN apt-get update && apt-get install -y \
    iputils-ping \
    traceroute \
    curl \
    wget \
    net-tools \
    openssh-server \
    snmp \
    snmp-mibs-downloader \
    python3 \
    python3-pip \
    nano \
    htop \
    iperf3 \
    tcpdump \
    && rm -rf /var/lib/apt/lists/*

# Configurar SSH
RUN mkdir /var/run/sshd
RUN echo 'root:admin123' | chpasswd
RUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Instalar agente Zabbix
RUN wget https://repo.zabbix.com/zabbix/6.4/ubuntu/pool/main/z/zabbix-release/zabbix-release_6.4-1+ubuntu22.04_all.deb
RUN dpkg -i zabbix-release_6.4-1+ubuntu22.04_all.deb
RUN apt-get update && apt-get install -y zabbix-agent2

# Script de inicializa√ß√£o
COPY startup.sh /startup.sh
RUN chmod +x /startup.sh

EXPOSE 22 10050
CMD ["/startup.sh"]
```

#### **Script startup.sh**
```bash
#!/bin/bash

# Configurar hostname baseado na vari√°vel de ambiente
if [ ! -z "$HOSTNAME" ]; then
    echo "$HOSTNAME" > /etc/hostname
    hostname "$HOSTNAME"
fi

# Configurar Zabbix Agent
if [ ! -z "$ZABBIX_SERVER" ]; then
    sed -i "s/Server=127.0.0.1/Server=$ZABBIX_SERVER/" /etc/zabbix/zabbix_agent2.conf
    sed -i "s/ServerActive=127.0.0.1/ServerActive=$ZABBIX_SERVER/" /etc/zabbix/zabbix_agent2.conf
    sed -i "s/Hostname=Zabbix server/Hostname=$HOSTNAME/" /etc/zabbix/zabbix_agent2.conf
fi

# Iniciar servi√ßos
service ssh start
service zabbix-agent2 start

# Manter container rodando
tail -f /dev/null
```

### **Docker Compose para Computadores**
```yaml
version: '3.8'

services:
  # Simula√ß√£o PC1 - VLAN 10
  pc1:
    build: ./docker-pc
    container_name: lab-pc1
    hostname: PC1-Finance
    environment:
      - HOSTNAME=PC1-Finance
      - ZABBIX_SERVER=172.16.0.20
    networks:
      vlan10:
        ipv4_address: 192.168.10.10
    cap_add:
      - NET_ADMIN
    privileged: true

  # Simula√ß√£o PC2 - VLAN 10  
  pc2:
    build: ./docker-pc
    container_name: lab-pc2
    hostname: PC2-Finance
    environment:
      - HOSTNAME=PC2-Finance
      - ZABBIX_SERVER=172.16.0.20
    networks:
      vlan10:
        ipv4_address: 192.168.10.20

  # Simula√ß√£o Server1 - VLAN 20
  srv1:
    build: ./docker-server
    container_name: lab-srv1
    hostname: SRV1-Web
    environment:
      - HOSTNAME=SRV1-Web
      - ZABBIX_SERVER=172.16.0.20
    networks:
      vlan20:
        ipv4_address: 192.168.20.10
    ports:
      - "8080:80"

  # Simula√ß√£o Server2 - VLAN 20
  srv2:
    build: ./docker-server
    container_name: lab-srv2
    hostname: SRV2-DB
    environment:
      - HOSTNAME=SRV2-DB
      - ZABBIX_SERVER=172.16.0.20
    networks:
      vlan20:
        ipv4_address: 192.168.20.20
    ports:
      - "3306:3306"

networks:
  vlan10:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.10.0/24
          gateway: 192.168.10.1
  
  vlan20:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.20.0/24
          gateway: 192.168.20.1

  management:
    driver: bridge
    ipam:
      config:
        - subnet: 172.16.0.0/24
          gateway: 172.16.0.1
```

---

## üîó Integra√ß√£o GNS3 + Docker

### **Configura√ß√£o de Conectividade**

#### **Conectar GNS3 ao Docker**
```bash
# Criar bridge para integra√ß√£o
sudo docker network create --driver bridge --subnet=192.168.100.0/24 gns3-bridge

# No GNS3, adicionar Cloud conectado √† bridge
# Cloud ‚Üí Configure ‚Üí Show special Ethernet interfaces ‚Üí docker0
```

#### **TAP Interfaces (Alternativa)**
```bash
# Criar TAP interface
sudo ip tuntap add tap0 mode tap
sudo ip link set tap0 up
sudo ip addr add 192.168.100.1/24 dev tap0

# Conectar container √† TAP
docker run -d --name test-pc --net=none ubuntu:22.04
sudo docker exec test-pc ip link set eth0 up
```

### **Scripts de Automa√ß√£o**

#### **deploy-lab.sh**
```bash
#!/bin/bash

echo "üöÄ Deploying Network Automation Lab..."

# Verificar pr√©-requisitos
echo "üìã Checking prerequisites..."
docker --version || { echo "Docker not found!"; exit 1; }
gns3server --version || { echo "GNS3 Server not found!"; exit 1; }

# Build das imagens Docker
echo "üê≥ Building Docker images..."
docker build -t lab-pc:latest ./docker-pc/
docker build -t lab-server:latest ./docker-server/

# Deploy dos containers
echo "üì¶ Deploying containers..."
docker-compose -f lab-compose.yml up -d

# Aguardar inicializa√ß√£o
echo "‚è≥ Waiting for services to start..."
sleep 30

# Verificar conectividade
echo "üîç Testing connectivity..."
docker exec lab-pc1 ping -c 3 192.168.10.1
docker exec lab-srv1 ping -c 3 192.168.20.1

echo "‚úÖ Lab deployment completed!"
echo "üåê Access points:"
echo "  - NetBox: http://172.16.0.10"
echo "  - Zabbix: http://172.16.0.20"
echo "  - GitLab: http://172.16.0.30"
```

---

## üìä Monitoramento do Laborat√≥rio

### **M√©tricas Coletadas**
- **RouterOS**: CPU, Memory, Interface utilization, Temperature
- **Docker Containers**: CPU, Memory, Network, Process count
- **Conectividade**: Ping, Traceroute, Bandwidth tests
- **Servi√ßos**: HTTP response time, Port availability

### **Dashboards Espec√≠ficos**
```
Lab Overview Dashboard:
‚îú‚îÄ‚îÄ Network Topology Status
‚îú‚îÄ‚îÄ RouterOS Performance Metrics  
‚îú‚îÄ‚îÄ Container Resource Usage
‚îú‚îÄ‚îÄ Connectivity Matrix
‚îî‚îÄ‚îÄ Alert Summary

Technical Dashboard:
‚îú‚îÄ‚îÄ Interface Traffic Graphs
‚îú‚îÄ‚îÄ CPU/Memory Trends
‚îú‚îÄ‚îÄ Network Latency Maps
‚îú‚îÄ‚îÄ Service Availability
‚îî‚îÄ‚îÄ Historical Performance
```

---

## üß™ Cen√°rios de Teste

### **1. Automated Configuration Deployment**
```bash
# Scenario: Deploy new VLAN via Ansible
1. Add VLAN to NetBox
2. Trigger GitLab pipeline
3. Ansible applies RouterOS configuration
4. Zabbix auto-discovers new devices
5. Verify connectivity and monitoring
```

### **2. Network Troubleshooting Simulation**
```bash
# Scenario: Interface failure simulation
1. Shutdown interface via RouterOS
2. Monitor alert generation in Zabbix
3. Trigger automatic failover (if configured)
4. Test recovery procedures
5. Document incident response
```

### **3. Capacity Planning Validation**
```bash
# Scenario: Bandwidth testing
1. Generate traffic with iperf3 between containers
2. Monitor interface utilization
3. Test QoS policies
4. Validate bandwidth limits
5. Plan capacity upgrades
```

---

## üìã Procedimentos Operacionais

### **Startup Sequence**
1. Iniciar GNS3 Server
2. Carregar projeto de laborat√≥rio
3. Start RouterOS instances (aguardar boot)
4. Deploy Docker containers
5. Verificar conectividade end-to-end
6. Validar servi√ßos de monitoramento

### **Shutdown Sequence**
1. Parar containers Docker
2. Save configurations RouterOS
3. Stop GNS3 instances
4. Backup project state
5. Shutdown GNS3 Server

### **Backup e Recovery**
```bash
# Backup GNS3 project
gns3server --backup /opt/gns3-projects/network-automation-lab.gns3project

# Backup RouterOS configs
./scripts/backup-routeros-configs.py

# Backup Docker volumes
docker run --rm -v gns3_data:/data -v $(pwd):/backup alpine tar czf /backup/docker-backup.tar.gz /data
```

---

## üéØ Resultados Esperados

### **Funcionalidades Validadas**
- ‚úÖ Descoberta autom√°tica de dispositivos
- ‚úÖ Configura√ß√£o via Ansible playbooks
- ‚úÖ Monitoramento proativo via Zabbix
- ‚úÖ Pipeline CI/CD funcionando
- ‚úÖ Alertas e escalation configurados
- ‚úÖ Dashboards operacionais

### **M√©tricas de Sucesso**
- **Disponibilidade**: 99%+ uptime simulado
- **Performance**: <5ms lat√™ncia interna
- **Monitoramento**: 100% dispositivos descobertos
- **Automa√ß√£o**: 90%+ tarefas automatizadas
- **Alertas**: <1% falsos positivos

### **Benef√≠cios do Ambiente**
- **Treinamento** sem risco √† produ√ß√£o
- **Valida√ß√£o** de mudan√ßas antes do deploy
- **Desenvolvimento** de playbooks Ansible
- **Teste** de cen√°rios de falha
- **Demonstra√ß√£o** de capacidades para stakeholders